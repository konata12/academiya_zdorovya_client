"use client";

import { getCookieInClientComponent } from "@/app/services/client/utils.service";
import { Department } from "@/app/types/data/departments.type";
import { useElementWidth } from "@/app/utils/hooks/common/useElementWidth";
import React, { use, useEffect, useState } from "react";
import styles from "./DepartmentPhoneNumberBtn.module.scss";

export default function DepartmentPhoneNumberBtn({
	departmentsPromise,
}: {
	departmentsPromise: Promise<Department[]>;
}) {
	const [number, setNumber] = useState("Loading...");
	const { width, ref } = useElementWidth<HTMLDivElement>(6);
	const departments = use(departmentsPromise);

	useEffect(() => {
		const id = getCookieInClientComponent("departmentId");
		const department = departments.find((department) => `${department.id}` === id);

		if (department) {
			setNumber(department.hotline);
		} else {
			setNumber("Loading...");
		}
	}, []);

	return (
		<a href={`tel:${number}`} className={`${styles.link}`}>
			<div
				className={`btn yellow xxl brown ${styles.infoBtn}`}
				ref={ref}
				style={
					width <= 728
						? {
								height: 0,
								opacity: 0,
								width: 0,
								padding: 0,
								border: "none",
							}
						: undefined
				}
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="44"
					height="44"
					viewBox="0 0 44 44"
					fill="none"
				>
					<path
						d="M23.8335 1.83333C23.8335 1.3471 24.0266 0.880786 24.3704 0.536969C24.7143 0.193152 25.1806 -1.9134e-06 25.6668 -1.9134e-06C30.5275 0.00533601 35.1875 1.93859 38.6245 5.3756C42.0615 8.81261 43.9948 13.4727 44.0001 18.3333C44.0001 18.8196 43.807 19.2859 43.4632 19.6297C43.1194 19.9735 42.653 20.1667 42.1668 20.1667C41.6806 20.1667 41.2143 19.9735 40.8704 19.6297C40.5266 19.2859 40.3335 18.8196 40.3335 18.3333C40.3291 14.4448 38.7825 10.7168 36.0329 7.96726C33.2833 5.21767 29.5553 3.67103 25.6668 3.66666C25.1806 3.66666 24.7143 3.47351 24.3704 3.12969C24.0266 2.78588 23.8335 2.31956 23.8335 1.83333ZM25.6668 11C27.6117 11 29.477 11.7726 30.8523 13.1479C32.2275 14.5231 33.0001 16.3884 33.0001 18.3333C33.0001 18.8196 33.1933 19.2859 33.5371 19.6297C33.8809 19.9735 34.3472 20.1667 34.8335 20.1667C35.3197 20.1667 35.786 19.9735 36.1298 19.6297C36.4737 19.2859 36.6668 18.8196 36.6668 18.3333C36.6639 15.4168 35.504 12.6206 33.4418 10.5584C31.3795 8.4961 28.5833 7.33624 25.6668 7.33333C25.1806 7.33333 24.7143 7.52649 24.3704 7.8703C24.0266 8.21412 23.8335 8.68043 23.8335 9.16667C23.8335 9.65289 24.0266 10.1192 24.3704 10.463C24.7143 10.8068 25.1806 11 25.6668 11ZM42.3373 30.6882C43.3997 31.7535 43.9964 33.1967 43.9964 34.7013C43.9964 36.2059 43.3997 37.6491 42.3373 38.7145L40.669 40.6377C25.654 55.0128 -10.8844 18.4837 3.26897 3.421L5.3773 1.58766C6.44388 0.554906 7.87418 -0.0164119 9.35876 -0.00268804C10.8433 0.0110359 12.2628 0.608698 13.3101 1.661C13.367 1.71783 16.7641 6.13066 16.7641 6.13066C17.7722 7.18965 18.3333 8.59637 18.3309 10.0584C18.3285 11.5204 17.7628 12.9253 16.7513 13.981L14.6283 16.6503C15.8032 19.505 17.5306 22.0995 19.7112 24.2845C21.8919 26.4696 24.4828 28.2022 27.3351 29.3828L30.021 27.247C31.0768 26.2363 32.4814 25.6712 33.943 25.6692C35.4046 25.6671 36.8108 26.2283 37.8695 27.236C37.8695 27.236 42.2805 30.6313 42.3373 30.6882ZM39.8146 33.3538C39.8146 33.3538 35.4275 29.9787 35.3706 29.9218C34.9929 29.5473 34.4826 29.3372 33.9507 29.3372C33.4188 29.3372 32.9085 29.5473 32.5308 29.9218C32.4813 29.9732 28.7835 32.9193 28.7835 32.9193C28.5343 33.1177 28.2377 33.2477 27.923 33.2966C27.6083 33.3454 27.2862 33.3115 26.9886 33.198C23.2935 31.8222 19.9372 29.6684 17.147 26.8823C14.3568 24.0963 12.198 20.7431 10.8168 17.05C10.6943 16.7483 10.6544 16.4195 10.7011 16.0973C10.7478 15.7751 10.8795 15.4711 11.0826 15.2167C11.0826 15.2167 14.0288 11.517 14.0783 11.4693C14.4528 11.0916 14.6629 10.5813 14.6629 10.0494C14.6629 9.51754 14.4528 9.00719 14.0783 8.6295C14.0215 8.5745 10.6463 4.18366 10.6463 4.18366C10.263 3.83993 9.76264 3.65584 9.24792 3.66913C8.73321 3.68243 8.24307 3.8921 7.87797 4.25517L5.76964 6.0885C-4.57403 18.5258 27.0895 48.433 37.9886 38.1333L39.6588 36.2083C40.0502 35.8458 40.2853 35.3453 40.3143 34.8126C40.3434 34.2799 40.1642 33.7568 39.8146 33.3538Z"
						fill="#FEED01"
					/>
				</svg>
				<div>
					<p className={styles.title}>Гаряча лінія</p>
					<address className={styles.phoneNumber}>{number}</address>
				</div>
			</div>
		</a>
	);
}
